<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Schedule a Call - Walden Ridge</title>

  <link rel="icon" type="image/png" href="../favicon.png" />

  <script>
    document.documentElement.classList.add('js');
    if ('fonts' in document) {
      Promise.all([
        document.fonts.load('400 1em IBM Plex Sans'),
        document.fonts.load('600 1em IBM Plex Sans'),
        document.fonts.load('600 1em Cormorant Garamond'),
        document.fonts.load('700 1em JunicodeExpBold')
      ]).then(() => document.documentElement.classList.add('fonts-loaded'))
        .catch(() => document.documentElement.classList.add('fonts-loaded'));
      setTimeout(() => document.documentElement.classList.add('fonts-loaded'), 2000);
    } else {
      document.documentElement.classList.add('fonts-loaded');
    }
  </script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600&family=IBM+Plex+Sans:wght@300;400;500;600&display=swap" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600&family=IBM+Plex+Sans:wght@300;400;500;600&display=swap"></noscript>

  <link rel="stylesheet" href="../styles.css" />

  <style>
    .shell { max-width: 920px; margin: 0 auto; padding: 0 var(--outer-margin); }
    .card { border: 1px solid var(--line-soft); border-radius: 12px; padding: 20px; background: rgba(255,255,255,0.25); }
    label { display:block; font-size: 12px; letter-spacing: 0.14em; text-transform: uppercase; opacity: 0.9; margin: 0 0 6px; }
    input[type="text"], input[type="email"], input[type="tel"], textarea {
      width: 100%; padding: 12px 12px; border-radius: 10px;
      border: 1px solid var(--line-soft); background: rgba(255,255,255,0.65);
      font-family: var(--font-body); font-size: 15px; line-height: 1.45;
    }
    textarea { min-height: 110px; resize: vertical; }
    .grid { display:grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 14px 18px; }
    .full { grid-column: 1 / -1; }
    .muted { opacity: 0.8; }
    .actions { display:flex; gap: 12px; flex-wrap: wrap; align-items:center; margin-top: 14px; }
    .status { margin-top: 12px; font-size: 14px; opacity: 0.9; }
    .status-ok { color: #1d3e2f; }
    .status-bad { color: #7a2f2f; }
    @media (max-width: 740px) { .grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body class="page-schedule">

  <header class="site-header">
    <a href="../" class="logo-block">
      <h1 class="logo-wordmark">WALDEN RIDGE</h1>
      <p class="logo-subtitle">Hospitality Design &amp;&nbsp;Construction</p>
    </a>

    <nav class="main-nav">
      <a href="../our-story/">Our Story</a>
      <a href="../strategy/">Strategy</a>
      <a href="../portfolio/">Portfolio</a>
      <a href="../leadership/">Leadership</a>
    </nav>
  </header>

  <main class="shell" style="padding-top: 18px;">
    <div class="card">
      <h1 style="margin:0 0 6px;">Schedule a Call</h1>
      <p class="muted" style="margin:0 0 14px;">
        A brief introductory call to assess fit and determine whether Walden Ridge can be helpful.
      </p>

      <p class="muted" style="margin:0 0 14px;">
        Typical topics include:<br>
        – Hotel renovation or repositioning scope<br>
        – Brand requirements and timing considerations<br>
        – Capital constraints and execution risk<br>
        – Advisory or delivery pathways<br><br>
        This call is exploratory and non-binding. If appropriate, next steps will be outlined following the discussion.
      </p>

      <div class="card" style="padding:14px 16px; margin: 0 0 14px; background: rgba(255,255,255,0.35);">
        <div style="font-size:12px; letter-spacing:0.14em; text-transform:uppercase; opacity:0.85;">Availability (Eastern)</div>
        <div style="margin-top:6px;">Mon–Fri, 8:00 AM – 5:00 PM · 15-minute calls</div>
      </div>

      <form id="wr-schedule" novalidate>
        <div class="grid">
          <div>
            <label>Your name <span style="color:#7a2f2f; font-weight:600;">*</span></label>
            <input name="name" type="text" required />
          </div>
          <div>
            <label>Your email <span style="color:#7a2f2f; font-weight:600;">*</span></label>
            <input name="email" type="email" required />
          </div>
          <div>
            <label>Phone</label>
            <input name="phone" type="tel" />
          </div>
          <div>
            <label>Property / Project</label>
            <input name="property" type="text" />
          </div>

          <div class="full">
            <label>Select a date <span style="color:#7a2f2f; font-weight:600;">*</span></label>
            <div id="slot-picker" class="card" style="padding:16px; background: rgba(255,255,255,0.35);">
              <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
                <button type="button" id="cal-prev" class="btn btn-secondary" style="padding:10px 12px; border-radius:999px;">←</button>
                <div id="cal-title" style="font-size:18px; font-weight:600; letter-spacing:-0.01em;"></div>
                <button type="button" id="cal-next" class="btn btn-secondary" style="padding:10px 12px; border-radius:999px;">→</button>
              </div>

              <div style="display:grid; grid-template-columns: repeat(7, 1fr); gap:10px; margin-top:14px; text-align:center;">
                <div style="font-size:12px; letter-spacing:0.14em; text-transform:uppercase; opacity:0.7;">Sun</div>
                <div style="font-size:12px; letter-spacing:0.14em; text-transform:uppercase; opacity:0.7;">Mon</div>
                <div style="font-size:12px; letter-spacing:0.14em; text-transform:uppercase; opacity:0.7;">Tue</div>
                <div style="font-size:12px; letter-spacing:0.14em; text-transform:uppercase; opacity:0.7;">Wed</div>
                <div style="font-size:12px; letter-spacing:0.14em; text-transform:uppercase; opacity:0.7;">Thu</div>
                <div style="font-size:12px; letter-spacing:0.14em; text-transform:uppercase; opacity:0.7;">Fri</div>
                <div style="font-size:12px; letter-spacing:0.14em; text-transform:uppercase; opacity:0.7;">Sat</div>
              </div>

              <div id="cal-grid" style="display:grid; grid-template-columns: repeat(7, 1fr); gap:10px; margin-top:10px;"></div>

              <div style="margin-top:16px;">
                <div style="font-size:12px; letter-spacing:0.14em; text-transform:uppercase; opacity:0.8;">Select a time (ET)</div>
                <div id="time-grid" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap:10px; margin-top:10px;"></div>
              </div>
            </div>

            <input type="hidden" name="slot_date" id="slot_date" required />
            <input type="hidden" name="slot_time" id="slot_time" required />
          </div>

          <div class="full">
            <label>Notes</label>
            <textarea name="notes" placeholder="Any constraints, participants, or context"></textarea>
          </div>
        </div>

        <div class="actions">
          <button class="btn btn-primary" type="submit">Request a call</button>
          <a class="btn btn-secondary" id="mailto-fallback" href="#">Email instead</a>
          <span id="status" class="status"></span>
        </div>
      </form>

      <p class="muted" style="margin-top:12px;">We’ll confirm a time window shortly.</p>
    </div>
  </main>

  <script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxpqCxmIbQQGecvCclMtg6RZK-gPHLSGFeYh1-5xa3Qz72Ag8-vtT0cT6BspglWETTEeA/exec";
    const form = document.getElementById('wr-schedule');
    const statusEl = document.getElementById('status');
    const mailto = document.getElementById('mailto-fallback');

    const calTitle = document.getElementById('cal-title');
    const calGrid = document.getElementById('cal-grid');
    const btnPrev = document.getElementById('cal-prev');
    const btnNext = document.getElementById('cal-next');
    const timeGrid = document.getElementById('time-grid');
    const slotDate = document.getElementById('slot_date');
    const slotTime = document.getElementById('slot_time');

    const TZ = 'America/New_York';
    const START_HOUR = 8;
    const END_HOUR = 17; // end at 5pm
    const SLOT_MIN = 15;

    function setStatus(msg, kind){
      statusEl.textContent = msg || '';
      statusEl.classList.remove('status-ok','status-bad');
      if(kind==='ok') statusEl.classList.add('status-ok');
      if(kind==='bad') statusEl.classList.add('status-bad');
    }

    function fmtMonthTitle(d){
      return d.toLocaleString('en-US', { month: 'long', year: 'numeric' });
    }

    function ymd(d){
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
      return `${y}-${m}-${day}`;
    }

    function isWeekday(d){
      const day = d.getDay();
      return day >= 1 && day <= 5;
    }

    function buildSlots(){
      const out=[];
      for(let h=START_HOUR; h<END_HOUR; h++){
        for(let min=0; min<60; min+=SLOT_MIN){
          const hh = String(h).padStart(2,'0');
          const mm = String(min).padStart(2,'0');
          out.push(`${hh}:${mm}`);
        }
      }
      return out;
    }

    const SLOTS = buildSlots();

    function clearActive(container){
      container.querySelectorAll('[data-active="true"]').forEach(el => el.dataset.active = 'false');
    }

    function renderTimes(){
      timeGrid.innerHTML='';
      SLOTS.forEach(t => {
        const b=document.createElement('button');
        b.type='button';
        b.textContent=t;
        b.className='btn btn-secondary';
        b.style.borderRadius='12px';
        b.style.padding='12px 12px';
        b.style.justifyContent='center';
        b.dataset.value=t;
        b.dataset.active='false';
        b.addEventListener('click', () => {
          clearActive(timeGrid);
          b.dataset.active='true';
          slotTime.value=t;
          updateMailto();
        });
        timeGrid.appendChild(b);
      });
    }

    function renderCalendar(view){
      calTitle.textContent = fmtMonthTitle(view);
      calGrid.innerHTML='';

      const first = new Date(view.getFullYear(), view.getMonth(), 1);
      const startDow = first.getDay();
      const daysInMonth = new Date(view.getFullYear(), view.getMonth()+1, 0).getDate();

      // blanks
      for(let i=0;i<startDow;i++){
        const blank=document.createElement('div');
        calGrid.appendChild(blank);
      }

      const today = new Date();
      today.setHours(0,0,0,0);

      for(let day=1; day<=daysInMonth; day++){
        const d=new Date(view.getFullYear(), view.getMonth(), day);
        d.setHours(0,0,0,0);

        const b=document.createElement('button');
        b.type='button';
        b.textContent=String(day);
        b.style.border='1px solid var(--line-soft)';
        b.style.background='rgba(255,255,255,0.5)';
        b.style.borderRadius='999px';
        b.style.height='48px';
        b.style.width='48px';
        b.style.margin='0 auto';
        b.style.display='inline-flex';
        b.style.alignItems='center';
        b.style.justifyContent='center';
        b.style.cursor='pointer';

        const selectable = isWeekday(d) && d >= today;
        if(!selectable){
          b.style.opacity='0.35';
          b.style.cursor='not-allowed';
          b.disabled=true;
        }

        b.dataset.value=ymd(d);
        b.dataset.active='false';

        b.addEventListener('click', () => {
          clearActive(calGrid);
          b.dataset.active='true';
          slotDate.value=b.dataset.value;
          updateMailto();
        });

        calGrid.appendChild(b);
      }

      // style active state
      calGrid.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('mouseenter', () => {
          if(btn.disabled) return;
          btn.style.borderColor='rgba(0,0,0,0.25)';
        });
        btn.addEventListener('mouseleave', () => {
          if(btn.dataset.active==='true') return;
          btn.style.borderColor='var(--line-soft)';
        });
      });
    }

    function applyActiveStyles(){
      // Date
      calGrid.querySelectorAll('button').forEach(btn => {
        if(btn.dataset.active==='true'){
          btn.style.background='rgba(29, 62, 47, 0.10)';
          btn.style.borderColor='rgba(29, 62, 47, 0.35)';
        } else {
          btn.style.background='rgba(255,255,255,0.5)';
          btn.style.borderColor='var(--line-soft)';
        }
      });
      // Time
      timeGrid.querySelectorAll('button').forEach(btn => {
        if(btn.dataset.active==='true'){
          btn.style.background='rgba(29, 62, 47, 0.10)';
          btn.style.borderColor='rgba(29, 62, 47, 0.35)';
        } else {
          btn.style.background='transparent';
          btn.style.borderColor='var(--line-soft)';
        }
      });
    }

    let view = new Date();
    view = new Date(view.getFullYear(), view.getMonth(), 1);

    btnPrev.addEventListener('click', () => {
      view = new Date(view.getFullYear(), view.getMonth()-1, 1);
      renderCalendar(view);
      applyActiveStyles();
    });
    btnNext.addEventListener('click', () => {
      view = new Date(view.getFullYear(), view.getMonth()+1, 1);
      renderCalendar(view);
      applyActiveStyles();
    });

    function collect(){
      const fd = new FormData(form);
      return Object.fromEntries(fd.entries());
    }

    function buildMailto(d){
      const subject = 'Walden Ridge | Initial Consultation';
      const when = (d.slot_date && d.slot_time) ? `${d.slot_date} ${d.slot_time} ET` : '';
      const body = [
        'Call request',
        '',
        `Name: ${d.name||''}`,
        `Email: ${d.email||''}`,
        `Phone: ${d.phone||''}`,
        `Property: ${d.property||''}`,
        when ? '' : '',
        when ? `Requested slot (ET): ${when}` : 'Requested slot (ET):',
        '',
        d.notes ? `Notes: ${d.notes}` : ''
      ].filter(Boolean).join('\n');
      return `mailto:workwithus@waldenridgeco.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
    }

    function updateMailto(){
      const d = collect();
      mailto.href = buildMailto(d);
      applyActiveStyles();
    }

    form.addEventListener('input', updateMailto);

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const d = collect();

      if(!d.name || !d.email || !d.slot_date || !d.slot_time){
        setStatus('Please select a date and time, and fill required fields.', 'bad');
        return;
      }

      if(!WEB_APP_URL || WEB_APP_URL.includes('__APPS_SCRIPT_WEBAPP_URL__')){
        setStatus('Scheduling endpoint not configured yet. Use “Email instead”.', 'bad');
        return;
      }

      try{
        setStatus('Submitting…', null);
        const res = await fetch(WEB_APP_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ kind: 'schedule_request', ...d, tz: TZ, duration_min: 15 })
        });
        const txt = await res.text();
        let j; try{ j = JSON.parse(txt); } catch { j = { ok:false, raw:txt }; }
        if(!res.ok || !j.ok){
          setStatus(j.error || 'Submit failed.', 'bad');
          return;
        }
        setStatus('Request received. We will confirm shortly.', 'ok');
        form.reset();
        slotDate.value='';
        slotTime.value='';
        renderCalendar(view);
        renderTimes();
        updateMailto();
      }catch(err){
        setStatus('Network error. Use “Email instead”.', 'bad');
      }
    });

    // init
    renderCalendar(view);
    renderTimes();
    updateMailto();
  </script>
</body>
</html>
